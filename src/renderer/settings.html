<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Screen Helper - Settings</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Courier New', monospace;
      background: #1a1a1a;
      color: #00ffff;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      color: #ffff00;
      font-size: 24px;
      margin-bottom: 5px;
    }

    .header p {
      font-size: 14px;
      opacity: 0.8;
    }

    .settings-section {
      background: rgba(0, 255, 255, 0.1);
      border: 1px solid rgba(0, 255, 255, 0.3);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .settings-section h3 {
      color: #ffff00;
      font-size: 16px;
      margin-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 0, 0.3);
      padding-bottom: 5px;
    }

    .setting-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
      padding: 10px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
    }

    .setting-item:last-child {
      margin-bottom: 0;
    }

    .setting-label {
      flex: 1;
      margin-right: 15px;
    }

    .setting-label .name {
      font-weight: bold;
      color: #00ffff;
      font-size: 14px;
    }

    .setting-label .description {
      font-size: 12px;
      opacity: 0.7;
      margin-top: 3px;
    }

    .setting-control {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    input[type="number"], input[type="range"] {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid #00ffff;
      color: #00ffff;
      padding: 5px 8px;
      border-radius: 3px;
      font-family: inherit;
      font-size: 12px;
      width: 80px;
      text-align: center;
    }

    input[type="range"] {
      width: 120px;
      padding: 0;
    }

    input[type="number"]:focus, input[type="range"]:focus {
      outline: none;
      border-color: #ffff00;
      box-shadow: 0 0 5px rgba(255, 255, 0, 0.3);
    }

    .range-labels {
      display: flex;
      justify-content: space-between;
      width: 120px;
      font-size: 10px;
      opacity: 0.6;
      margin-top: 3px;
    }

    .current-value {
      min-width: 30px;
      text-align: center;
      color: #ffff00;
      font-weight: bold;
    }

    .buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 30px;
    }

    .btn {
      background: rgba(0, 255, 255, 0.2);
      border: 1px solid #00ffff;
      color: #00ffff;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-family: inherit;
      font-size: 14px;
      transition: all 0.2s ease;
      min-width: 100px;
    }

    .btn:hover {
      background: rgba(0, 255, 255, 0.4);
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    }

    .btn.primary {
      background: rgba(255, 255, 0, 0.2);
      border-color: #ffff00;
      color: #ffff00;
    }

    .btn.primary:hover {
      background: rgba(255, 255, 0, 0.4);
      box-shadow: 0 0 10px rgba(255, 255, 0, 0.3);
    }

    .btn.danger {
      background: rgba(255, 0, 0, 0.2);
      border-color: #ff0000;
      color: #ff0000;
    }

    .btn.danger:hover {
      background: rgba(255, 0, 0, 0.4);
      box-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
    }

    .preview {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(0, 255, 255, 0.3);
      border-radius: 4px;
      padding: 10px;
      margin-top: 15px;
      font-size: 12px;
    }

    .preview .title {
      color: #ffff00;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .status {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0, 255, 0, 0.9);
      color: #000;
      padding: 8px 15px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      display: none;
      z-index: 1000;
    }

    .zoom-explanation {
      background: rgba(255, 165, 0, 0.1);
      border: 1px solid rgba(255, 165, 0, 0.3);
      border-radius: 4px;
      padding: 10px;
      margin-top: 10px;
      font-size: 11px;
      line-height: 1.4;
    }

    .zoom-explanation .title {
      color: #ffa500;
      font-weight: bold;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>AI Screen Helper Settings</h1>
    <p>Configure grid layout and zoom behavior</p>
  </div>

  <div class="settings-section">
    <h3>Grid Layout</h3>
    
    <div class="setting-item">
      <div class="setting-label">
        <div class="name">Grid Rows</div>
        <div class="description">Number of horizontal grid divisions</div>
      </div>
      <div class="setting-control">
        <input type="number" id="rows" min="2" max="20" value="6">
        <span class="current-value" id="rowsValue">6</span>
      </div>
    </div>

    <div class="setting-item">
      <div class="setting-label">
        <div class="name">Grid Columns</div>
        <div class="description">Number of vertical grid divisions</div>
      </div>
      <div class="setting-control">
        <input type="number" id="cols" min="2" max="30" value="10">
        <span class="current-value" id="colsValue">10</span>
      </div>
    </div>

    <div class="setting-item">
      <div class="setting-label">
        <div class="name">Grid Opacity</div>
        <div class="description">Transparency of grid borders, numbers, and backgrounds</div>
      </div>
      <div class="setting-control">
        <input type="range" id="gridOpacity" min="0.1" max="1.0" step="0.1" value="0.8">
        <span class="current-value" id="gridOpacityValue">0.8</span>
      </div>
    </div>

    <div class="setting-item">
      <div class="setting-label">
        <div class="name">Show Coordinates</div>
        <div class="description">Display (x, y) coordinates in grid squares</div>
      </div>
      <div class="setting-control">
        <input type="checkbox" id="showCoordinates" style="margin: 0;">
        <span class="current-value" id="showCoordinatesValue">Off</span>
      </div>
    </div>

    <div class="setting-item">
      <div class="setting-label">
        <div class="name">Number Prefix</div>
        <div class="description">Text to display before grid numbers (e.g., "[" for "[1]")</div>
      </div>
      <div class="setting-control">
        <input type="text" id="numberPrefix" maxlength="3" placeholder="" style="width: 60px; text-align: center;">
        <span class="current-value" id="numberPrefixValue">None</span>
      </div>
    </div>

    <div class="setting-item">
      <div class="setting-label">
        <div class="name">Number Suffix</div>
        <div class="description">Text to display after grid numbers (e.g., "]" for "[1]")</div>
      </div>
      <div class="setting-control">
        <input type="text" id="numberSuffix" maxlength="3" placeholder="" style="width: 60px; text-align: center;">
        <span class="current-value" id="numberSuffixValue">None</span>
      </div>
    </div>

    <div class="preview">
      <div class="title">Grid Preview</div>
      <span id="gridPreview">6 rows × 10 columns = 60 total cells</span>
    </div>
  </div>

  <div class="settings-section">
    <h3>Zoom Window</h3>
    
    <div class="setting-item">
      <div class="setting-label">
        <div class="name">Zoom Factor</div>
        <div class="description">Magnification level for zoom window</div>
      </div>
      <div class="setting-control">
        <input type="range" id="zoomFactor" min="1" max="10" step="1" value="3">
        <span class="current-value" id="zoomFactorValue">3x</span>
      </div>
    </div>

    <div class="setting-item">
      <div class="setting-label">
        <div class="name">Zoom Padding</div>
        <div class="description">Extra area around selected cell to show in zoom</div>
      </div>
      <div class="setting-control">
        <input type="range" id="zoomPadding" min="0" max="2" step="0.1" value="0.5">
        <span class="current-value" id="zoomPaddingValue">0.5</span>
      </div>
    </div>

    <div class="setting-item">
      <div class="setting-label">
        <div class="name">Zoom Grid Size</div>
        <div class="description">Size of each clickable square in zoom window (smaller = more precise)</div>
      </div>
      <div class="setting-control">
        <input type="range" id="zoomGridSize" min="10" max="50" step="5" value="30">
        <span class="current-value" id="zoomGridSizeValue">30px</span>
      </div>
    </div>

    <div class="setting-item">
      <div class="setting-label">
        <div class="name">Zoom Window Opacity</div>
        <div class="description">Visual opacity of zoom window elements (separate from main grid)</div>
      </div>
      <div class="setting-control">
        <input type="range" id="zoomOpacity" min="0.1" max="1.0" step="0.1" value="0.8">
        <span class="current-value" id="zoomOpacityValue">0.8</span>
      </div>
    </div>

    <div class="setting-item">
      <div class="setting-label">
        <div class="name">Zoom Number Layout</div>
        <div class="description">How many numbers to display per square in zoom window</div>
      </div>
      <div class="setting-control">
        <select id="zoomNumberLayout" style="padding: 4px 8px; background: #2a2a2a; color: #00ffff; border: 1px solid rgba(0,255,255,0.3); border-radius: 4px;">
          <option value="center">Center Only (1 number)</option>
          <option value="two-corners">Two Corners Only (2 numbers)</option>
          <option value="all-corners">All Corners + Center (5 numbers)</option>
        </select>
        <span class="current-value" id="zoomNumberLayoutValue">All Corners + Center</span>
      </div>
    </div>

    <div class="zoom-explanation">
      <div class="title">What is Zoom Padding?</div>
      <div>
        • <strong>0.0</strong> = Show only the selected grid cell<br>
        • <strong>0.5</strong> = Show cell + half a cell on each side (recommended)<br>
        • <strong>1.0</strong> = Show cell + one full cell on each side<br>
        • <strong>2.0</strong> = Show cell + two cells on each side
      </div>
    </div>

    <div class="preview">
      <div class="title">Zoom Preview</div>
      <span id="zoomPreview">3x magnification with 0.5 cell padding</span>
    </div>
  </div>

  <div class="buttons">
    <button class="btn danger" id="resetBtn">Reset to Defaults</button>
    <button class="btn" id="cancelBtn">Cancel</button>
    <button class="btn primary" id="saveBtn">Save Settings</button>
  </div>

  <div class="status" id="statusMsg">Settings saved!</div>

  <script>
    const { ipcRenderer } = require('electron');

    let currentSettings = {};

    // UI elements
    const elements = {
      rows: document.getElementById('rows'),
      cols: document.getElementById('cols'),
      gridOpacity: document.getElementById('gridOpacity'),
      showCoordinates: document.getElementById('showCoordinates'),
      numberPrefix: document.getElementById('numberPrefix'),
      numberSuffix: document.getElementById('numberSuffix'),
      zoomFactor: document.getElementById('zoomFactor'),
      zoomPadding: document.getElementById('zoomPadding'),
      zoomGridSize: document.getElementById('zoomGridSize'),
      zoomOpacity: document.getElementById('zoomOpacity'),
      zoomNumberLayout: document.getElementById('zoomNumberLayout'),
      
      rowsValue: document.getElementById('rowsValue'),
      colsValue: document.getElementById('colsValue'),
      gridOpacityValue: document.getElementById('gridOpacityValue'),
      showCoordinatesValue: document.getElementById('showCoordinatesValue'),
      numberPrefixValue: document.getElementById('numberPrefixValue'),
      numberSuffixValue: document.getElementById('numberSuffixValue'),
      zoomFactorValue: document.getElementById('zoomFactorValue'),
      zoomPaddingValue: document.getElementById('zoomPaddingValue'),
      zoomGridSizeValue: document.getElementById('zoomGridSizeValue'),
      zoomOpacityValue: document.getElementById('zoomOpacityValue'),
      zoomNumberLayoutValue: document.getElementById('zoomNumberLayoutValue'),
      
      gridPreview: document.getElementById('gridPreview'),
      zoomPreview: document.getElementById('zoomPreview'),
      
      saveBtn: document.getElementById('saveBtn'),
      cancelBtn: document.getElementById('cancelBtn'),
      resetBtn: document.getElementById('resetBtn'),
      statusMsg: document.getElementById('statusMsg')
    };

    function updatePreviews() {
      const rows = parseInt(elements.rows.value);
      const cols = parseInt(elements.cols.value);
      const gridOpacity = parseFloat(elements.gridOpacity.value);
      const showCoordinates = elements.showCoordinates.checked;
      const numberPrefix = elements.numberPrefix.value;
      const numberSuffix = elements.numberSuffix.value;
      const zoomFactor = parseInt(elements.zoomFactor.value);
      const zoomPadding = parseFloat(elements.zoomPadding.value);
      const zoomGridSize = parseInt(elements.zoomGridSize.value);
      const zoomOpacity = parseFloat(elements.zoomOpacity.value);
      const zoomNumberLayout = elements.zoomNumberLayout.value;
      
      // Show example with prefix/suffix
      const exampleNumber = `${numberPrefix}1${numberSuffix}`;
      elements.gridPreview.textContent = `${rows} rows × ${cols} columns = ${rows * cols} total cells (e.g., "${exampleNumber}")`;
      
      const layoutText = {
        'center': 'center only (1 number)',
        'two-corners': 'two corners only (2 numbers)', 
        'all-corners': 'all corners + center (5 numbers)'
      }[zoomNumberLayout];
      elements.zoomPreview.textContent = `${zoomFactor}x magnification with ${zoomPadding} cell padding, ${zoomGridSize}px squares, ${layoutText}`;
      
      // Update value displays
      elements.rowsValue.textContent = rows;
      elements.colsValue.textContent = cols;
      elements.gridOpacityValue.textContent = `${Math.round(gridOpacity * 100)}%`;
      elements.showCoordinatesValue.textContent = showCoordinates ? 'On' : 'Off';
      elements.numberPrefixValue.textContent = numberPrefix || 'None';
      elements.numberSuffixValue.textContent = numberSuffix || 'None';
      elements.zoomFactorValue.textContent = `${zoomFactor}x`;
      elements.zoomPaddingValue.textContent = zoomPadding.toFixed(1);
      elements.zoomGridSizeValue.textContent = `${zoomGridSize}px`;
      elements.zoomOpacityValue.textContent = `${Math.round(zoomOpacity * 100)}%`;
      const layoutLabels = {
        'center': 'Center Only (1)',
        'two-corners': 'Two Corners (2)',
        'all-corners': 'All Corners + Center (5)'
      };
      elements.zoomNumberLayoutValue.textContent = layoutLabels[zoomNumberLayout] || 'All Corners + Center';
    }

    function loadSettings(settings) {
      currentSettings = settings;
      
      elements.rows.value = settings.rows;
      elements.cols.value = settings.cols;
      elements.gridOpacity.value = settings.gridOpacity || 0.8;
      elements.showCoordinates.checked = settings.showCoordinates !== undefined ? settings.showCoordinates : false;
      elements.numberPrefix.value = settings.numberPrefix || '';
      elements.numberSuffix.value = settings.numberSuffix || '';
      elements.zoomFactor.value = settings.zoomFactor;
      elements.zoomPadding.value = settings.zoomPadding;
      elements.zoomGridSize.value = settings.zoomGridSize || 30;
      elements.zoomOpacity.value = settings.zoomOpacity || 0.8;
      
      // Handle backwards compatibility with old showZoomCornerNumbers setting
      let layoutValue = settings.zoomNumberLayout || 'all-corners';
      if (!settings.zoomNumberLayout && settings.showZoomCornerNumbers !== undefined) {
        layoutValue = settings.showZoomCornerNumbers ? 'all-corners' : 'center';
      }
      elements.zoomNumberLayout.value = layoutValue;
      
      updatePreviews();
    }

    function saveSettings() {
      const newSettings = {
        rows: parseInt(elements.rows.value),
        cols: parseInt(elements.cols.value),
        gridOpacity: parseFloat(elements.gridOpacity.value),
        showCoordinates: elements.showCoordinates.checked,
        numberPrefix: elements.numberPrefix.value,
        numberSuffix: elements.numberSuffix.value,
        zoomFactor: parseInt(elements.zoomFactor.value),
        zoomPadding: parseFloat(elements.zoomPadding.value),
        zoomGridSize: parseInt(elements.zoomGridSize.value),
        zoomOpacity: parseFloat(elements.zoomOpacity.value),
        zoomNumberLayout: elements.zoomNumberLayout.value
      };
      
      ipcRenderer.send('save-settings', newSettings);
    }

    function resetSettings() {
      ipcRenderer.send('reset-settings');
    }

    function showStatus(message, duration = 2000) {
      elements.statusMsg.textContent = message;
      elements.statusMsg.style.display = 'block';
      
      setTimeout(() => {
        elements.statusMsg.style.display = 'none';
      }, duration);
    }

    // Event listeners for real-time updates
    ['rows', 'cols', 'gridOpacity', 'numberPrefix', 'numberSuffix', 'zoomFactor', 'zoomPadding', 'zoomGridSize', 'zoomOpacity'].forEach(id => {
      elements[id].addEventListener('input', updatePreviews);
    });
    
    // Special handling for checkboxes and dropdowns
    elements.showCoordinates.addEventListener('change', updatePreviews);
    elements.zoomNumberLayout.addEventListener('change', updatePreviews);

    // Button event listeners
    elements.saveBtn.addEventListener('click', saveSettings);
    elements.cancelBtn.addEventListener('click', () => {
      window.close();
    });
    elements.resetBtn.addEventListener('click', () => {
      if (confirm('Reset all settings to defaults? This cannot be undone.')) {
        resetSettings();
      }
    });

    // IPC event listeners
    ipcRenderer.on('load-settings', (event, settings) => {
      loadSettings(settings);
    });

    ipcRenderer.on('settings-saved', (event, settings) => {
      currentSettings = settings;
      showStatus('Settings saved successfully!');
    });

    ipcRenderer.on('settings-reset', (event, settings) => {
      loadSettings(settings);
      showStatus('Settings reset to defaults');
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        window.close();
      } else if (event.ctrlKey && event.key === 's') {
        event.preventDefault();
        saveSettings();
      }
    });

    // Initialize
    updatePreviews();
  </script>
</body>
</html>